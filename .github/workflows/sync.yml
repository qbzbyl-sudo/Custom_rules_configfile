# .github/workflows/sync.yml
name: Sync Proxy Config

on:
  # 1. 定时触发：使用cron语法，下面表示每6小时运行一次
  schedule:
    - cron: '0 */6 * * *'
  
  # 2. 手动触发：允许你在GitHub Actions页面手动点击运行
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 步骤1: 检出(checkout)你的仓库代码
      - name: Checkout repository
        uses: actions/checkout@v3

      # 步骤2: 设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 步骤3: 安装Python依赖库 (PyYAML用于处理YAML, requests用于下载)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml requests

      # 步骤4: 运行你的Python脚本
      - name: Run sync script
        env:
          # 从仓库的Secrets中读取订阅链接，并传递给脚本
          SUB_URL: ${{ secrets.SUB_URL }}
        run: python main.py

      # 步骤5: 如果文件有变化，则自动提交并推送到仓库
      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "chore: Auto sync proxy config"
          file_pattern: config.yaml # 只提交 config.yaml 文件的变动
